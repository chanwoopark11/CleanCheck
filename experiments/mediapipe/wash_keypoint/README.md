# 🫱🧼🔍 손씻기 시각화 시스템

이 프로젝트는 웹캠을 통해 사용자의 손 씻기 과정을 실시간으로 분석하고 시각화하여, 올바른 손 씻기 습관 형성을 돕는 시스템입니다. 손의 세척 상태를 손바닥/손등 별로 구분하고, 세척 여부를 직관적으로 보여줍니다.

---

### 📦 버전 히스토리

본 시스템은 사용자의 피드백과 기술 발전에 따라 총 세 가지 버전으로 진화해왔습니다.

#### **v1: 기본적인 손 랜드마크 추적 및 초기 시각화**
* **설명**: 시스템의 가장 초기 버전으로, 실시간 웹캠 영상에서 손의 랜드마크(관절, 특정 지점)를 감지하고 추적하는 데 집중했습니다. 사용자가 손을 서로 문지를 때 각 랜드마크 간의 거리를 기준으로 세척 여부를 판단하고 시각적으로 피드백을 제공합니다.
* **주요 기능 요약**:
    * **거리 기반 세척 판별**: 두 손의 랜드마크 간 거리가 특정 임계값 이하로 가까워지면 접촉으로 간주하고, 1초 이상 지속될 경우 해당 지점을 세척된 것으로 판단합니다.
    * **손목 이동 기반 위치 보간**: 손 랜드마크가 잠시 감지되지 않을 때, 포즈(Pose) 인식을 통해 감지된 손목의 이동량을 기반으로 손의 위치를 예측하여 시각화의 끊김을 줄였습니다.
    * **손바닥/손등 방향 추정**: 손 랜드마크의 2D 평면상 위치를 분석하여 각 손이 현재 손바닥을 향하고 있는지 손등을 향하고 있는지 추정합니다.
    * **칼만 필터 적용**: 랜드마크 좌표에 칼만 필터를 적용하여 노이즈를 줄이고 추적의 안정성을 높였습니다.
* **시각화**: 세척된 랜드마크는 특정 색상(예: 초록색/파란색)으로, 미세척 부위는 빨간색으로 표시됩니다.

#### **v2: 영역 기반 접촉 감지 및 시각화 개선**
* **설명**: v1의 기본적인 거리 기반 판단 방식의 한계를 보완하여, 더욱 정확하고 사용자 친화적인 시각화를 제공하는 중간 단계 버전입니다.
* **주요 기능 요약**:
    * **다각형(Convex Hull) 기반 접촉 감지**: 단순히 랜드마크 간 거리가 아닌, 한 손의 랜드마크들이 다른 손이 형성하는 외곽선(Convex Hull) 영역 안에 들어왔는지 여부를 판단하여 접촉을 감지합니다. 이는 실제 손 씻기 동작에 더 부합하는 정확한 접촉 인식을 가능하게 합니다.
    * **손바닥/손등 세척 구분 시각화**: 손바닥과 손등의 세척 상태를 명확히 구분하여 시각화하며, 세척 진행률에 따라 손 영역 전체에 색상 오버레이의 투명도가 변하여 직관적인 피드백을 제공합니다.
    * **손 방향 추정 안정화**: 순간적인 움직임으로 인한 잦은 손 방향 전환 감지를 방지하기 위해, 일정 프레임(`ORIENTATION_CONFIRM_FRAMES`) 동안 동일한 방향이 유지될 때만 최종 방향으로 인정하는 시간적 필터링을 도입했습니다.
    * **진행률 바 UI**: 화면 상단에 전체 손 씻기 진행률을 보여주는 막대 그래프(Progress Bar)를 추가하여, 사용자가 전체 세척 완료까지 얼마나 남았는지 시각적으로 확인할 수 있도록 했습니다.
    * **세척 초기화 기능**: `'r'` 키를 통해 언제든지 세척 상태를 초기화할 수 있는 기능을 추가하여 새로운 세션을 시작하기 용이하게 했습니다.

#### **v3: YOLO 기반 동작 인식 및 성능 최적화 (최신 버전)**
* **설명**: 현재 시스템의 최신 버전으로, 딥러닝 기반의 객체 감지(YOLO) 기술을 통합하여 단순한 접촉 감지를 넘어 사용자의 손 씻기 '동작'까지 인식합니다. 이를 통해 더욱 지능적이고 맥락에 맞는 손 씻기 가이드가 가능해졌습니다.
* **주요 기능 요약**:
    * **YOLO 기반 손 씻기 동작 분류**: `ultralytics`의 YOLO 모델을 활용하여 "Palm to Palm"과 같은 특정 손 씻기 동작을 실시간으로 감지합니다. 감지된 동작에 따라 세척 로직이 다르게 적용되어, 해당 동작이 목표로 하는 손 부위만 세척으로 간주합니다.
    * **YOLO 추론 간격 최적화**: YOLO 모델의 연산 부하를 줄이기 위해, 매 프레임이 아닌 일정 간격(`YOLO_INFERENCE_INTERVAL`)마다 동작 인식을 수행하도록 최적화했습니다. 이는 시스템의 전반적인 프레임 속도와 반응성을 향상시킵니다.
    * **현재 동작 상태 표시**: 화면에 현재 YOLO가 인식하고 있는 동작(예: "Action: Palm to Palm")을 텍스트로 표시하여, 사용자가 시스템의 인식 결과를 실시간으로 파악할 수 있도록 돕습니다.
    * **코드 안정성 강화**: 시각화 함수 내에서 발생할 수 있는 잠재적인 오류를 방지하기 위해 변수 초기화 및 딕셔너리 키 확인 로직을 추가하여 코드의 안정성을 높였습니다.

---

### 🔵 시각화 기준

* **세척된 부위**: 손바닥은 **초록색**으로, 손등은 **주황색** 또는 **파란색**으로 표시됩니다.
* **미세척 부위**: 아직 세척되지 않은 랜드마크는 **빨간색 원**으로 표시됩니다.
* **전체 세척률**: v2부터는 화면 상단의 진행률 바를 통해 전체 손 씻기 완료 진행률을 한눈에 확인할 수 있습니다.

---

### 🛠️ 요구사항

본 시스템을 실행하기 위한 주요 요구사항은 다음과 같습니다.

* **Python**: 3.8 이상 버전
* **OpenCV**: 컴퓨터 비전 처리를 위한 라이브러리
* **MediaPipe**: 손 랜드마크 감지 및 추적을 위한 라이브러리
* **YOLOv8**: (v3 버전에만 해당) 딥러닝 기반 동작 인식을 위한 `ultralytics` 패키지

